server:
  port: 40006
  shutdown: graceful
  tomcat:
    threads:
      max: 200
      min-spare: 10
    max-connections: 10000

spring:
  application:
    name: authsrv

  # Database
  datasource:
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:30001}/authsrv?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:root}
    driver-class-name: com.mysql.cj.jdbc.Driver

  # Flyway
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    baseline-version: 0

  # JPA
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true

  # Nacos 配置 (本地覆盖)
  cloud:
    nacos:
      server-addr: ${NACOS_SERVER:127.0.0.1:8848}
      username: ${NACOS_USERNAME:nacos}
      password: ${NACOS_PASSWORD:nacos}
      config:
        namespace: ${NACOS_NAMESPACE:public}
        file-extension: yml
        refresh-enabled: true
        shared-configs:
          - data-id: common.yml
            group: DEFAULT_GROUP
            refresh: true
      discovery:
        namespace: ${NACOS_NAMESPACE:public}
        ephemeral: true

# Nexora Security & Redis
nexora:
  security:
    jwt:
      secret: ${JWT_SECRET:default-secret-key-change-in-production}
      access-token-validity: 900
      refresh-token-validity: 604800
  redis:
    enabled: true
    mode: single
    single-server:
      address: redis://${REDIS_HOST:localhost}:${REDIS_PORT:6379}

# Management
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      application: ${spring.application.name}

# Logging
logging:
  level:
    root: INFO
    io.github.suj1e: DEBUG
    org.springframework.security: DEBUG
